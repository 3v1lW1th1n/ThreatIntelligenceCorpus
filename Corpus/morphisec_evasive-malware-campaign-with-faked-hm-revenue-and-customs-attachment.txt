
Evasive Malware Campaign with Faked HM Revenue and Customs Attachment

Posted by
Roy Moshailov on December 27, 2016 at 6:32 AM
                           

Find me on:

Twitter 





 The full report is also available as PDF. 
On December 12, 2016 Morphisec identified and monitored a new wave of sophisticated malware delivered via targeted phishing emails with malicious macro-based documents attached. The malicious documents themselves use a clever, new social engineering technique to convince the target to enable macros. Once enabled, the document calls an unknown downloader that resembles the Cerber downloader, but employs new obfuscation techniques.
This report analyzes the document attack chain. It is part of a series of reports produced by Morphisec Lab focusing on the most evasive and sophisticated in-memory malware.
The campaign recently identified by Morphisec uses several interesting modified evasive techniques and had an extremely low detection ratio on VirusTotal of only 1/ 54.

Despite the brand-new elements and variations, Morphisec’s Endpoint Threat Prevention stops this sophisticated attack at its first encounter without needing to change any rules.
 
 
 

4. Finally, the downloaded executable.
 
Morphisec observed different payloads downloaded by similar documents within a very short time period. We focus here on the most interesting executable malware.
RESOURCES:
Delphi file:
 This is part of Aimp3.exe of AIMP3 developed by AIMP DevTeam. AIMP is a freeware audio and video player for windows and Android, originally developed by a Russian developer.
What makes AIMP unique is its ability to load the entire media file into the RAM of the computer.  
Strings:
 
On uploading the malicious executable to Hybrid-analysis.com, we received following risk assessment:  

File details:  Based on Kerish Products [Kerish Doctor 2015, a Windows maintenance tool]
 
 Summary of malicious and suspicious indicators taken from  Hybrid-analysis.com and ThreatInfo (from December 15, 2016): 
 
 
Ndll and adavapi Libraries:

 
 
  
 
 
This function uses the PEB (Process Environment Block) of the current process (stored at fs:[30h]) to locate a linked list of loaded modules. The PEB contains a member called Ldr that is a pointer to a PEB_LDR_DATA structure.
The InMemoryOrderModuleList linked list is used to enumerate the loaded modules by the order that they're loaded in memory.
The technique of enumerating the loaded modules using the PEB is commonly used by malware to locate the base address (which is also the module handle) of certain DLL files to avoid declaring and using GetModuleHandle/LoadLibrary API call implicitly. 
There are a number of reasons for the attackers to apply such a bypass:
 
The macro-based evasion techniques used in this document have a very low detection ratio, demonstrating how most security solutions are always a few steps behind the attacker and how static based solutions cannot cope with today’s rapid changes in attack scenarios. Social engineering methods are also constantly evolving, as we see in the new technique used to lure victims into activating the attack. This makes it difficult to educate users in how to identify phishing mail. More and more file-less or partially file-less attacks like this one are cropping up, which easily evade file-based solutions by persisting in memory.
 
HASHs: 
Document “Statement of Liabilities.doc” – d526f134d2fd0bc1bf29b8c0f684a3c518a71c0f3066a85bf54fe9c9457bf39d
Downloader “doc.exe”- 3128b0461d4d36a8763da1685d226fae5594364947c6bdff026eebcbde97a1cc
 
