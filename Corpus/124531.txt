Malware That Targets Both Microsoft, Apple Operating Systems Found
Researchers came across a malicious Word document last week that doesn’t discriminate between OS platforms. The malicious Word document is designed to spread malware on either Mac OS X or Microsoft Windows, depending on where it’s opened.
Like many other strains of malware these days, the sample, which researchers at Fortinet observed on March 16, relies on tricking users into enabling macros.
Once opened and macros are enabled, malicious VBA, or Visual Basic for Applications, code is executed, which runs the AutoOpen() macro. The macro goes on to read a base64-encoded string in the file, which depending on the operating system, executes a certain script.
For victims running Mac OS X, the script, is fairly straightforward. It downloads a malicious file containing another script, written in python, that’s executed and attempts to communicate with the attacker’s server. The downloaded script is a modded version of a Python meterpreter file, researchers say.
Meterpreter, part of the Metasploit framework, is extensible payload component that uses in-memory DLL injection stagers. The tool has been adopted by several groups of late, including GCMAN and a group of attackers who have been spotted carrying out fileless malware-based attacks.
The script that triggers the exploit on Windows is a little more involved. Like a Russian nesting doll, one layer of base64-encoded data spawns a powershell script, which decompresses another layer of base-64-encoded code which leads to another powershell script. Once executed, the script finally downloads a 64-bit DLL file, which executes and communicates with the attacker’s server. Researchers with Fortinet believe the Windows side of the malware only affects 64-bit versions of Windows.
While they have a pretty good idea of how the malware spreads, researchers aren’t completely sure what the attackers behind it were after. Peixue Li, senior manager of FortiGuard Service Development and Security Research told Threatpost Thursday that when they observed TCP sessions to the attacker’s server – both Windows and Apple – the server wasn’t answering. Instead, Wireshark just gave them a TCP retransmission error message.
Macro malware that explicitly targets macOS isn’t necessarily new – but it has been a recent development. Researchers with Synack came across macro malware that executes solely on Mac machines back in February.
That malware, peddled by a group whose IP traces back to Russia, operated in a similar fashion. The victim would have to agree to enable macros for a Word document on the Mac version of Word. After enabled, a macro decodes data, and like the malware Fortinet researchers found, executes it in Python. The malware Synack found relies on leveraging a legitimate python post-exploitation OS X and Linux agent, EmPyre.
Fortinet’s researchers claim they’re still analyzing the malware, but Li says the fact that the malware’s Python post-exploitation agent is different than the one used by the malware seen by Synack separates it from a pack.
“The malware we analyzed targets both Mac OS and Windows… the Python post-exploitation agent used by the malware is different. One is EmPyre, the other is Meterpreter, Li said, “Cross-platform Macro-based malware could become a trend, perhaps.”
