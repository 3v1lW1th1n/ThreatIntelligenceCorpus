
					Leaked programming manual inspired development malware for ATMs					
Recently Kaspersky Lab spotted a series of attacks on ATM machines which were infected by the Tyupkin malware, the malicious code is used by criminal organizations to compomise the banking machines and force them to release cash on demand, at least 50 ATMs, mainly in Eastern Europe, have been infected.
Tyupkin isn’t the unique malware used by criminals to compromise ATMs, in May 2013 researchers spotted another ATM Trojan, dubbed Padpin, meanwhile in October 2013, security experts at Symantec warned about the Ploutus that was designed with the same intent.
The blog post published by Symantec refers to a strain of Ploutus malware detected in 2013 on ATMs in Mexico and is designed to compromise a certain type of standalone ATM with just the text messages.
“The new variant was identified as Backdoor.Ploutus.B (referred to as Ploutus throughout this blog). What was interesting about this variant of Ploutus was that it allowed cybercriminals to simply send an SMS to the compromised ATM, then walk up and collect the dispensed cash. It may seem incredible, but this technique is being used in a number of places across the world at this time.”

The attack scheme is very simple, the bad actor just needs to connect the ATM to a mobile phone via USB tethering and then initiate a shared Internet connection, which then can be used to send specific SMS commands to the phone attached or hardwired inside the ATM.
“Since the phone is connected to the ATM through the USB port, the phone also draws power from the connection, which charges the phone battery. As a result, the phone will remain powered up indefinitely.”
Of course, a similar attacks request a good knowledge of the ATM architecture and of the software it runs, for this reason many security experts are worried by a news of data leakage for physical components of automated teller machines (ATMs).
A leaked programming manual for interacting with the physical components of automated teller machines might have helped malware authors to design the malicious application that were used to steal cash from ATMs in recent cases observed worldwide.
Recently eighteen ATMs were compromised in Malaysia, the criminal gangs behind the attacks has stolen nearly 3 million Malaysian Ringgit, or over US$900,000, according to a the media agencies.
The experts at F-Secure has the opportunity to analyze Padpin samples and discovered that the malicious code interacts with the Extension for Financial Services DLL library(MSXFS.dll) that is specifically used by ATMs. The library provides a special API for the communication with the ATM’s PIN pad. PadPin isn’t the unique malware used by criminals that uses the library, also the Tyupkin invokes it.

“Analyzing the code, we started wondering how the malware author knows which pin pad service name to provide to the API so that the program is able to interact with the pin pad device,” the F-Secure researchers said in a blog post.
The researchers at F-Secure hghlighed that the DLL library is not officially documented by Microsoft, this mean that attackers gain access to the information in a different way.
 “It’s a valid question because the pin pad service name used in the code is quite unique and it is very unlikely one can figure out the service name without documentation.” added the expert.
Information on the Dll is available in a programmer’s reference manual from NCR, which is a popular manufacturer of ATMs and point-of-sale devices, the document was posted on an ebook site owned by Chinese online search company Baidu.
According the experts, non only malware programmers experienced in writing ATM applications may have obtained precious information by reading the leaked manual,  but also other coders.
“The documentation is helpful enough to give programmers some sample code as well,” the researchers said.
As explained in a previous post, physical defense of ATMs still represents an important deterrent against such kind of attacks, avoiding physical access to the ATMs by criminals is is possible to secure the machines.
Pierluigi Paganini
(Security Affairs –  ATMs, cybercrime)
