English (English)French (Français)German (Deutsch)Japanese (日本語)Korean (한국어)More languages
English (English)
French (Français)
German (Deutsch)
Japanese (日本語)
Korean (한국어)
More languages






Products









ProductsFireEye Helix
Network Security
Endpoint Security
Email Security
Threat Analytics Platform





Related ServicesFireEye as a Service
Threat Intelligence
Mandiant Consulting









FireEye Helix
A security operations platform that surfaces unseen threats and empowers expert decisions.Learn more





            VIEW ALL PRODUCTS




Services









I am breached!Incident Response Services


Am I at risk?Red Team Operations
Penetration Testing
Industrial Control Systems Healthcheck
Mergers & Acquisitions Risk Assessment
Cyber Insurance Risk Assessment





Am I compromised?Compromise Assessment


Am I prepared?Deployment and Integration Services
Incident Response Retainer
Response Readiness Assessment
Security Program Assessment
Tabletop Exercise





Prepare for future eventsEducation Services
Cyber Defense Center Development
Cyber Threat Intelligence Services
ThreatSpace






            VIEW ALL SERVICES




Solutions









Solutions forData Centers
Ransomware
Enterprise Networks
Incident Investigation
Small and Midsize Businesses
Endpoint Security: Far Beyond Prevention
Industrial Control Systems & Critical Infrastructure





IndustriesFinancial Services
Government
Healthcare
Higher Education
Retail









Security as a Service
Effective, efficient security with the value and scale you need, when you need it.Learn more





            VIEW ALL SOLUTIONS




Partners









FireEye PartnersFireEye Fuel Resellers
Strategic Alliance Partners
Cyber Risk Partners
Global Service Providers and MSSPs
Technology Integration Partners





Partner ResourcesPartner Enablement
Partner Portal
Education Center





Partnering with FireEyePartnering with FireEye
Become a Partner
Partner Certifications and Accreditations








Support









Get SupportContact Support
Customer Portal
Programs





Find AnswersCommunities
Supported Products
Support Notices





DocumentationDocumentation Portal








Resources









Intelligence Briefing and BulletinsRecent Zero-Day Exploits
Annual Threat Reports
Threat Intelligence Reports
Threat Intelligence Reports by Industry
Advanced Persistent Threat Groups


FireEye BlogsThreat Research Blog
Products and Services Blog
Executive Perspectives Blog
View all




Cyber SecurityWhat is Cyber Security?
Advanced Detection and Prevention
Best Defense Against Spear Phishing
Target Criminals to Stop Cyber Crime
How Cyber Attacks Compromise Networks
Anatomy of Advanced Persistent Threats
Cyber Security ROI for CEOs
Cost and Value of Cyber Security
What is a Zero-Day Exploit?
Cost of a Data Breach
Ransomware: Tool of Choice for Cyber Extortion
5 Ways to Simplify Security Operations





TrainingEducation Center


Free DownloadsFree Software Downloads








Company









About UsWhy FireEye?
Customer Stories
Awards and Honors
Leadership
Board of Directors
Investor Relations
Legal Documentation





News and EventsNewsroom
Press Releases
Webinars
Events





CareersJob Opportunities
University Relations


ContactContact FireEye


.g04 .megamenu-list a{padding-right:38px;line-height:1.358;padding-bottom:2px}@media (min-width:60em){.g04 .n03-sub_container{padding-bottom:23px}}@media(min-width:64em) and (max-width:64.5em){.g04 .megamenu-tab:first-child .megamenu-title{padding-left:14px}}@media (min-width:68em) and (max-width:69em){.g04 .megamenu-tab:first-child .megamenu-title{padding-left:30px}}








Why FireEye?
FireEye understands cyber attacks and the threat actors responsible for them better than anyone else.Learn more








Products









ProductsFireEye Helix
Network Security
Endpoint Security
Email Security
Threat Analytics Platform





Related ServicesFireEye as a Service
Threat Intelligence
Mandiant Consulting









FireEye Helix
A security operations platform that surfaces unseen threats and empowers expert decisions.Learn more





            VIEW ALL PRODUCTS




Products

Products
FireEye Helix
Network Security
Endpoint Security
Email Security
Threat Analytics Platform

FireEye Helix
Network Security
Endpoint Security
Email Security
Threat Analytics Platform
Related Services
FireEye as a Service
Threat Intelligence
Mandiant Consulting

FireEye as a Service
Threat Intelligence
Mandiant Consulting
A security operations platform that surfaces unseen threats and empowers expert decisions.


Services









I am breached!Incident Response Services


Am I at risk?Red Team Operations
Penetration Testing
Industrial Control Systems Healthcheck
Mergers & Acquisitions Risk Assessment
Cyber Insurance Risk Assessment





Am I compromised?Compromise Assessment


Am I prepared?Deployment and Integration Services
Incident Response Retainer
Response Readiness Assessment
Security Program Assessment
Tabletop Exercise





Prepare for future eventsEducation Services
Cyber Defense Center Development
Cyber Threat Intelligence Services
ThreatSpace






            VIEW ALL SERVICES




Services

I am breached!
Incident Response Services

Incident Response Services
Am I at risk?
Red Team Operations
Penetration Testing
Industrial Control Systems Healthcheck
Mergers & Acquisitions Risk Assessment
Cyber Insurance Risk Assessment

Red Team Operations
Penetration Testing
Industrial Control Systems Healthcheck
Mergers & Acquisitions Risk Assessment
Cyber Insurance Risk Assessment
Am I compromised?
Compromise Assessment

Compromise Assessment
Am I prepared?
Deployment and Integration Services
Incident Response Retainer
Response Readiness Assessment
Security Program Assessment
Tabletop Exercise

Deployment and Integration Services
Incident Response Retainer
Response Readiness Assessment
Security Program Assessment
Tabletop Exercise
Prepare for future events
Education Services
Cyber Defense Center Development
Cyber Threat Intelligence Services
ThreatSpace

Education Services
Cyber Defense Center Development
Cyber Threat Intelligence Services
ThreatSpace


Solutions









Solutions forData Centers
Ransomware
Enterprise Networks
Incident Investigation
Small and Midsize Businesses
Endpoint Security: Far Beyond Prevention
Industrial Control Systems & Critical Infrastructure





IndustriesFinancial Services
Government
Healthcare
Higher Education
Retail









Security as a Service
Effective, efficient security with the value and scale you need, when you need it.Learn more





            VIEW ALL SOLUTIONS




Solutions

Solutions for
Data Centers
Ransomware
Enterprise Networks
Incident Investigation
Small and Midsize Businesses
Endpoint Security: Far Beyond Prevention
Industrial Control Systems & Critical Infrastructure

Data Centers
Ransomware
Enterprise Networks
Incident Investigation
Small and Midsize Businesses
Endpoint Security: Far Beyond Prevention
Industrial Control Systems & Critical Infrastructure
Industries
Financial Services
Government
Healthcare
Higher Education
Retail

Financial Services
Government
Healthcare
Higher Education
Retail
Effective, efficient security with the value and scale you need, when you need it.


Partners









FireEye PartnersFireEye Fuel Resellers
Strategic Alliance Partners
Cyber Risk Partners
Global Service Providers and MSSPs
Technology Integration Partners





Partner ResourcesPartner Enablement
Partner Portal
Education Center





Partnering with FireEyePartnering with FireEye
Become a Partner
Partner Certifications and Accreditations








Partners

FireEye Partners
FireEye Fuel Resellers
Strategic Alliance Partners
Cyber Risk Partners
Global Service Providers and MSSPs
Technology Integration Partners

FireEye Fuel Resellers
Strategic Alliance Partners
Cyber Risk Partners
Global Service Providers and MSSPs
Technology Integration Partners
Partner Resources
Partner Enablement
Partner Portal
Education Center

Partner Enablement
Partner Portal
Education Center
Partnering with FireEye
Partnering with FireEye
Become a Partner
Partner Certifications and Accreditations

Partnering with FireEye
Become a Partner
Partner Certifications and Accreditations


Support









Get SupportContact Support
Customer Portal
Programs





Find AnswersCommunities
Supported Products
Support Notices





DocumentationDocumentation Portal








Support

Get Support
Contact Support
Customer Portal
Programs

Contact Support
Customer Portal
Programs
Find Answers
Communities
Supported Products
Support Notices

Communities
Supported Products
Support Notices
Documentation
Documentation Portal

Documentation Portal


Resources









Intelligence Briefing and BulletinsRecent Zero-Day Exploits
Annual Threat Reports
Threat Intelligence Reports
Threat Intelligence Reports by Industry
Advanced Persistent Threat Groups


FireEye BlogsThreat Research Blog
Products and Services Blog
Executive Perspectives Blog
View all




Cyber SecurityWhat is Cyber Security?
Advanced Detection and Prevention
Best Defense Against Spear Phishing
Target Criminals to Stop Cyber Crime
How Cyber Attacks Compromise Networks
Anatomy of Advanced Persistent Threats
Cyber Security ROI for CEOs
Cost and Value of Cyber Security
What is a Zero-Day Exploit?
Cost of a Data Breach
Ransomware: Tool of Choice for Cyber Extortion
5 Ways to Simplify Security Operations





TrainingEducation Center


Free DownloadsFree Software Downloads








Resources

Intelligence Briefing and Bulletins
Recent Zero-Day Exploits
Annual Threat Reports
Threat Intelligence Reports
Threat Intelligence Reports by Industry
Advanced Persistent Threat Groups

Recent Zero-Day Exploits
Annual Threat Reports
Threat Intelligence Reports
Threat Intelligence Reports by Industry
Advanced Persistent Threat Groups
FireEye Blogs
Threat Research Blog
Products and Services Blog
Executive Perspectives Blog
View all
Threat Research Blog
Products and Services Blog
Executive Perspectives Blog
View all
Cyber Security
What is Cyber Security?
Advanced Detection and Prevention
Best Defense Against Spear Phishing
Target Criminals to Stop Cyber Crime
How Cyber Attacks Compromise Networks
Anatomy of Advanced Persistent Threats
Cyber Security ROI for CEOs
Cost and Value of Cyber Security
What is a Zero-Day Exploit?
Cost of a Data Breach
Ransomware: Tool of Choice for Cyber Extortion
5 Ways to Simplify Security Operations

What is Cyber Security?
Advanced Detection and Prevention
Best Defense Against Spear Phishing
Target Criminals to Stop Cyber Crime
How Cyber Attacks Compromise Networks
Anatomy of Advanced Persistent Threats
Cyber Security ROI for CEOs
Cost and Value of Cyber Security
What is a Zero-Day Exploit?
Cost of a Data Breach
Ransomware: Tool of Choice for Cyber Extortion
5 Ways to Simplify Security Operations
Training
Education Center

Education Center
Free Downloads
Free Software Downloads

Free Software Downloads


Company









About UsWhy FireEye?
Customer Stories
Awards and Honors
Leadership
Board of Directors
Investor Relations
Legal Documentation





News and EventsNewsroom
Press Releases
Webinars
Events





CareersJob Opportunities
University Relations


ContactContact FireEye


.g04 .megamenu-list a{padding-right:38px;line-height:1.358;padding-bottom:2px}@media (min-width:60em){.g04 .n03-sub_container{padding-bottom:23px}}@media(min-width:64em) and (max-width:64.5em){.g04 .megamenu-tab:first-child .megamenu-title{padding-left:14px}}@media (min-width:68em) and (max-width:69em){.g04 .megamenu-tab:first-child .megamenu-title{padding-left:30px}}








Why FireEye?
FireEye understands cyber attacks and the threat actors responsible for them better than anyone else.Learn more







Company

About Us
Why FireEye?
Customer Stories
Awards and Honors
Leadership
Board of Directors
Investor Relations
Legal Documentation

Why FireEye?
Customer Stories
Awards and Honors
Leadership
Board of Directors
Investor Relations
Legal Documentation
News and Events
Newsroom
Press Releases
Webinars
Events

Newsroom
Press Releases
Webinars
Events
Careers
Job Opportunities
University Relations

Job Opportunities
University Relations
Contact
Contact FireEye

Contact FireEye
FireEye understands cyber attacks and the threat actors responsible for them better than anyone else.

							To give you the best possible experience, this site uses cookies.  Find out more on how we use cookies.Accept
Decline


Home
FireEye Blogs
Threat Research Blog
FireEye Uncovers CVE-2017-8759: Zero-Day Used in t...

Home
FireEye Blogs
Threat Research Blog
FireEye Uncovers CVE-2017-8759: Zero-Day Used in t...

FireEye Uncovers CVE-2017-8759: Zero-Day Used in the Wild to Distribute FINSPY
FireEye recently detected a malicious Microsoft Office RTF document that leveraged CVE-2017-8759, a SOAP WSDL parser code injection vulnerability. This vulnerability allows a malicious actor to inject arbitrary code during the parsing of SOAP WSDL definition contents. FireEye analyzed a Microsoft Word document where attackers used the arbitrary code injection to download and execute a Visual Basic script that contained PowerShell commands.
FireEye shared the details of the vulnerability with Microsoft and has been coordinating public disclosure timed with the release of a patch to address the vulnerability and security guidance, which can be found here.
FireEye email, endpoint and network products detected the malicious documents.
Vulnerability Used to Target Russian Speakers
The malicious document, “Проект.doc” (MD5: fe5c4d6bb78e170abf5cf3741868ea4c), might have been used to target a Russian speaker. Upon successful exploitation of CVE-2017-8759, the document downloads multiple components (details follow), and eventually launches a FINSPY payload (MD5: a7b990d5f57b244dd17e9a937a41e7f5).
FINSPY malware, also reported as FinFisher or WingBird, is available for purchase as part of a “lawful intercept” capability. Based on this and previous use of FINSPY, we assess with moderate confidence that this malicious document was used by a nation-state to target a Russian-speaking entity for cyber espionage purposes. Additional detections by FireEye’s Dynamic Threat Intelligence system indicates that related activity, though potentially for a different client, might have occurred as early as July 2017.
CVE-2017-8759 WSDL Parser Code Injection
A code injection vulnerability exists in the WSDL parser module within the PrintClientProxy method (http://referencesource.microsoft.com/ - System.Runtime.Remoting/metadata/wsdlparser.cs,6111). The IsValidUrl does not perform correct validation if provided data that contains a CRLF sequence. This allows an attacker to inject and execute arbitrary code. A portion of the vulnerable code is shown in Figure 1.

Figure 1: Vulnerable WSDL Parser
When multiple address definitions are provided in a SOAP response, the code inserts the “//base.ConfigureProxy(this.GetType(),” string after the first address, commenting out the remaining addresses. However, if a CRLF sequence is in the additional addresses, the code following the CRLF will not be commented out. Figure 2 shows that due to lack validation of CRLF, a System.Diagnostics.Process.Start method call is injected. The generated code will be compiled by csc.exe of .NET framework, and loaded by the Office executables as a DLL.

Figure 2: SOAP definition VS Generated code
The In-the-Wild Attacks
The attacks that FireEye observed in the wild leveraged a Rich Text Format (RTF) document, similar to the CVE-2017-0199 documents we previously reported on. The malicious sampled contained an embedded SOAP monikers to facilitate exploitation (Figure 3).

Figure 3: SOAP Moniker
The payload retrieves the malicious SOAP WSDL definition from an attacker-controlled server. The WSDL parser, implemented in System.Runtime.Remoting.ni.dll of .NET framework, parses the content and generates a .cs source code at the working directory. The csc.exe of .NET framework then compiles the generated source code into a library, namely http[url path].dll. Microsoft Office then loads the library, completing the exploitation stage.  Figure 4 shows an example library loaded as a result of exploitation.

Figure 4: DLL loaded
Upon successful exploitation, the injected code creates a new process and leverages mshta.exe to retrieve a HTA script named “word.db” from the same server. The HTA script removes the source code, compiled DLL and the PDB files from disk and then downloads and executes the FINSPY malware named “left.jpg,” which in spite of the .jpg extension and “image/jpeg” content-type, is actually an executable. Figure 5 shows the details of the PCAP of this malware transfer.

Figure 5: Live requests
The malware will be placed at %appdata%\Microsoft\Windows\OfficeUpdte-KB[ 6 random numbers ].exe. Figure 6 shows the process create chain under Process Monitor.

Figure 6: Process Created Chain
The Malware
The “left.jpg” (md5: a7b990d5f57b244dd17e9a937a41e7f5) is a variant of FINSPY. It leverages heavily obfuscated code that employs a built-in virtual machine – among other anti-analysis techniques – to make reversing more difficult. As likely another unique anti-analysis technique, it parses its own full path and searches for the string representation of its own MD5 hash. Many resources, such as analysis tools and sandboxes, rename files/samples to their MD5 hash in order to ensure unique filenames. This variant runs with a mutex of "WininetStartupMutex0".
Conclusion
CVE-2017-8759 is the second zero-day vulnerability used to distribute FINSPY uncovered by FireEye in 2017. These exposures demonstrate the significant resources available to “lawful intercept” companies and their customers. Furthermore, FINSPY has been sold to multiple clients, suggesting the vulnerability was being used against other targets.
It is possible that CVE-2017-8759 was being used by additional actors. While we have not found evidence of this, the zero day being used to distribute FINSPY in April 2017, CVE-2017-0199 was simultaneously being used by a financially motivated actor. If the actors behind FINSPY obtained this vulnerability from the same source used previously, it is possible that source sold it to additional actors.
Acknowledgement
Thank you to Dhanesh Kizhakkinan, Joseph Reyes, FireEye Labs Team, FireEye FLARE Team and FireEye iSIGHT Intelligence for their contributions to this blog. We also thank everyone from the Microsoft Security Response Center (MSRC) who worked with us on this issue.


        This entry was posted on Tue Sep 12 13:00 EDT 2017 and filed under Genwei Jiang, James
  T. Bennett, Zero-day Vulnerability, Ben Read, and 0-day.
    

Sign up for email updates
Get information and insight on today's advanced threats from the leader in advanced threat prevention.
Stay Connected
 



LinkedIn




Twitter




Facebook




Google+




YouTube




Podcast





LinkedIn





Twitter





Facebook





Google+





YouTube





Podcast


Cyber Threat Map

Company
About FireEye
Customer Stories
Careers
Partners
Investor Relations
Supplier Documents

About FireEye
Customer Stories
Careers
Partners
Investor Relations
Supplier Documents
News & Events
Newsroom
Press Releases
Webinars
Events
Blogs
Communication Preferences

Newsroom
Press Releases
Webinars
Events
Blogs
Communication Preferences
Technical Support
Incident?
Report Security Issue
Contact Support
Customer Portal
Communities
Documentation Portal

Incident?
Report Security Issue
Contact Support
Customer Portal
Communities
Documentation Portal
Cyber Threat Map


					Copyright © 2018 FireEye, Inc. All rights reserved. Privacy & Cookies Policy | Privacy Shield | Legal Documentation

