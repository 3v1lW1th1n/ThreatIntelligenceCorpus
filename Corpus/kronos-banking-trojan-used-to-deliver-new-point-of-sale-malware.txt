Kronos Banking Trojan Used to Deliver New Point-of-Sale Malware
Overview
Banking Trojans continue to evolve and threat actors are using them in new ways, even as the massive Dridex campaigns of 2015 have given way to ransomware and other payloads. Most recently, we observed several relatively large email campaigns distributing the Kronos banking Trojan. In these campaigns, though, Kronos acted as a loader with a new Point-of-Sale (POS) malware dubbed ScanPOS as the secondary payload.
These campaigns not only represent an uptick in our observed instances of Kronos banker but also a new application of the malware that was first introduced in June 2014 and that we most recently described in relation to campaigns targeting Canada [1].
Email Campaigns
On November 10 and 14, Proofpoint observed several large email campaigns of tens of thousands of messages each, targeting a range of verticals including hospitality, higher education, financial Services, and healthcare. The relative volumes by vertical are shown in Figure 1.

Figure 1: Vertical targeting across several campaigns
These campaigns reached global audiences but primarily targeted the United Kingdom and North America.
The email messages contained a document attachment or a link such as hxxp://intranet.excelsharepoint[.]com/profile/Employee[.]php?id=[base64 encoded e-mail address]. This domain is under attacker control but pretends to be associated with Microsoft SharePoint. Clicking the link causes the targeted user to download a malicious document (Fig. 2 and 3).

Figure 2: E-mail containing malicious attachment only

Figure 3: Email containing malicious attachment and link to malicious document
The documents we observed contained a macro which downloaded Kronos [2] from a URL such as hxxp://info.docs-sharepoint[.]com/officeup[.]exe . The Kronos payload had a command and control (C&C) of hxxp://www.networkupdate[.]club/kbps/connect[.]php . The Kronos payloads received tasks to download at least three different payloads from the following URLs:

Figure 4: Malicious macro document with “Enable Content” lure
Both Smoke Loader [3] payloads were configured to use hxxp://webfeed.updatesnetwork[.]com/feedweb/feed[.]php as their C&C. So far we have not observed any additional payloads associated with these two Smoke Loader samples. However, as noted in the next section, we have observed a ZeuS variant payload being downloaded by a different Smoke Loader sample using the same C&C.
The third payload we observed is a new Point-of-Sale (POS) malware called ScanPOS that is capable of exfiltrating via HTTP (Fig. 5) credit card numbers that are discovered by searching in the memory of running processes. This new POS variant only has a single, hard-coded C&C: hxxp://invoicesharepoint[.]com/gateway[.]php. As with several other domains described here, these pretend to be associated with Microsoft SharePoint but are independent and under attacker control.
Exfiltrated data is base64 encoded and include:
Please refer to the discovery article by our colleagues at Morphick for additional technical analysis on this new POS variant [4].

Figure 5: ScanPOS exfiltrating CC data over HTTP
Other Activity
In a November 8 campaign that preceded this activity, we observed similar emails and URLs following the same pattern as those used to deliver Kronos. However, in this campaign we observed links leading to RIG-v Exploit Kit (EK), followed by a redirect to ZIP-compressed .pif Smoke Loader and ZeuS. The links followed a pattern that was very similar to the more recent campaigns: hxxp://invoice.docs-sharepoint[.]com/profile/profile[.]php?id=[base64 e-mail address]. These links utilized an iframe to redirect potential victims to a RIG-v instance located at add.souloventure[.]org as well as to /download.php on the same server as the original link (Fig. 6).

Figure 6: Iframe redirect to RIG-v and payload download
Unfortunately, we did not observe any payloads delivered through this particular redirect chain. The /download.php returns an EmployeeID-47267.zip payload that we observed containing either a Smoke Loader variant using hxxp://webfeed.updatesnetwork[.]com/feedweb/feed[.]php as its C&C or a ZeuS variant using hxxps://feed.networksupdates[.]com/feed/webfeed[.]xml as its C&C. In the instance where we observed Smoke Loader, Smoke Loader downloaded an identical (same hash) ZeuS variant.
Conclusion
The campaigns distributing ScanPOS are heavily targeted at the hospitality vertical in North America and the UK, among other countries that observe the Christmas and/or Thanksgiving holidays. With the holidays approaching and their associated heavy travel and shopping, organizations should be especially vigilant with respect to potential infection with POS malware, banking Trojans, and other malware that may be used to exploit seasonal trends. We will continue to monitor Kronos campaigns, ScanPOS distribution, and other threats as they emerge.
