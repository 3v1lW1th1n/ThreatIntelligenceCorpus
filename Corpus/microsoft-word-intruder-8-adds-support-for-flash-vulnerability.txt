Microsoft Word Intruder 8 Adds Support for Flash Vulnerability CVE-2016-4117
Analysis
Microsoft Word Intruder (MWI) is a kit designed for building malicious Microsoft Word documents for use in targeted attacks. The most recent iteration of MWI - Version 8 - supports a wide variety of vulnerabilities that actors can exploit via crafted Microsoft Word documents. Available on underground markets since 2013, we first identified MWI in March 2015 [1]. FireEye [2] and Sophos [3] provided additional documentation of the kit later that year.
In the mid-July 2016, an advertisement for MWI on an underground site stated that this exploit document builder integrated CVE-2016-4117 (Adobe Flash Player up to 21.0.0.213). At the end of August, MWI incremented to version 8, with the message “MICROSOFT WORD INTRUDER 8 (MWI8): CVE-2016-4117 + CVE-2015-2545 + CVE-2015-1641 + CVE-2012-0158” in an advertisement for the new version (see Appendix).
We were able to observe this updated version in the wild dropping various payloads; for example, we saw it dropping RTM Banker on October 21. In this case, the document “business project laveco price.doc.rtf” was delivered via email and targeted at retail, financial, and manufacturing verticals.

Figure 1: Network traffic for MWI and its RTM Banker payload network traffic on October 21 
Note that we observed the same instance of RTM fed by Empire Pack (RIG variant [4]) in multiple infection vectors (both compromised sites and malvertising) in multiple countries (the Netherlands, Norway, Germany, Spain, Switzerland, Sweden, Austria, and Ireland).
Another observed MWI document “Изменения условий взаимодействия.doc” (translated from Russian as “Changes of conditions of cooperation.doc”) dropped a TeamViewer-based RAT on September 7.

Figure 2: MWI document installing a TeamViewer-based RAT and reporting to C&C
The Adobe Flash Player zero-day CVE-2016-4117 zero-day was discovered by FireEye [5], and was first used by an APT actor named “ScarCruft”, as described by Kaspersky [6]. The exploit was later integrated into multiple exploits kits [7].
When we examined the MWI CVE-2016-4117 addition, it appears that this exploit document builder reused the original exploit code without modifying anything except the shellcode. The first Flash file decrypts a second Flash file, which triggers the vulnerability. In fact, the MWI author maintained the same decryption routine and the XOR key for this second file.

Figure 3: Original sample on the left, MWI exploit integration on the right
This second Flash file appears to be the exact same file from the original exploit, without any modification by the MWI author.

Figure 4: ActiveScript code triggering the vulnerability
Conclusion
Microsoft Word Intruder is an example of the sort of sophisticated crimeware used to develop attacks on a variety of targets. By incorporating new vulnerabilities in vectors such as Adobe Flash, MWI users increase the likelihood that their malicious documents will successfully infect target devices. This particular vulnerability has also been incorporated in a number of web-based exploit kits, making it imperative that users and organizations who choose to maintain Flash on their systems update to the latest versions.
