Malicious PHP Script Infects 2,400 Websites in the Past WeekA botnet dubbed Brain Food is giving webmasters indigestion with related attacks that push bogus diet pills and IQ-boosting pills via web pages hosted on legitimate sites. So far, spammers have been successful, thanks to an effective Hypertext Preprocessor (PHP) script (also called Brain Food) that has adroitly avoided detection on websites hosting the pitches.Over the past four months, researchers at Proofpoint said they have tracked 5,000 Brain Food compromised websites. In a post outlining its research Friday, Proofpoint said 2,400 of those compromised sites have been active over the past seven days pushing dubious pills under the false premise the product claims made were originally on television shows Shark Tank and on identified as Entertainment Today.“While this botnet is small compared to other spam sending infrastructure, the size of this botnet is sufficient to provide the operators with easily reconfigured redirects,” wrote Kevin Epstein, VP Threat Operations, at Proofpoint in an email interview with Threatpost.Domain registrar and hosting firm GoDaddy has been disproportionately impacted by the Brain Food script, accounting for 40 percent of the 5,000 compromised sites. That’s followed by hosting firms DreamHost, UnitedLayer and CyrusOne.“An individual website may contain multiple copies of the PHP script. We have observed this script installed on websites using different content management systems including WordPress and Joomla,” researchers wrote.Spam attacks hit inboxes in the form of stripped down email messages typically with no subject and basic greeting (see below).The body of the message contained a URL shortener link using Google’s goog.gl and bit.ly. Spammers had been blocked by Google’s URL shortener service when Google stopped allowing anonymous users from creating goo.gl links. “By the end of April, the spammer appears to have found a means of  circumventing the Google restrictions,” wrote researchers.Recipients who click on the link are redirected to the compromised website that hosts the diet or intelligence-boosting pill pitch.Brain Food: Malicious PHP ScriptThe script itself employs several layers of defense to evade detection by researchers and search engine crawlers. “The code is polymorphic and obfuscated with multiple layers of base64 encoding,” they said. “A version recently uploaded to a malware repository was not flagged by any antivirus engine.”When a site is infected with the malicious Brain Food PHP code and crawled, the script redirects to the correct page. Next, it staggers for five seconds and “redirects to the root of the compromised domain, delays and returns nothing, or redirects to the UNICEF website,” researchers said.“The attackers want victims to get redirected. But it wants search engines, analysts and sandboxes to get redirected to an innocuous site – whether it be the root of the compromised domain or the UNICEF website. The built-in delays are enough for many automated analysis systems to time out without detecting a potentially malicious redirect,” Epstein said.Criminals maintain control over the landing pages and keep stats on the campaigns from C2 servers prostodomen1[.]com and thptlienson[.]com.Even more worrisome, is a backdoor in the Brain Food code that allows “remote execution of shell code on web servers which are configured to allow the PHP ‘system’ command,” researchers wrote.Epstein told Threatpost, the backdoor feature is not currently being utilized. “Many web hosts do not allow access to the PHP system command. Exact potential impact depends on backend configurations and security settings,” he said.